<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Smart Chef</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Identity Services (for G-Sign-In) -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    :root {
      --primary: #e11d48;
      --primary-dark: #be123c;
      --bg: #fff8f8;
      --fg: #222;
      --card-bg: #fff;
      --muted: #666;
    }
    [data-theme="dark"] {
      --bg: #1f1f1f;
      --fg: #fafafa;
      --card-bg: #2a2a2a;
      --muted: #aaa;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: var(--bg);
      color: var(--fg);
      transition: background 0.3s, color 0.3s;
    }
    header {
      background: var(--primary);
      color: white;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .brand img {
      width: 36px;
      height: 36px;
      object-fit: cover;
      border-radius: 50%;
    }
    .brand h1 {
      font-family: 'Playfair Display', serif;
      font-size: 24px;
      margin: 0;
    }
    .theme-toggle {
      background: none;
      border: 2px solid white;
      color: white;
      border-radius: 4px;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }
    .theme-toggle:hover {
      background: rgba(255,255,255,0.2);
    }
    .container {
      max-width: 800px;
      margin: auto;
      padding: 16px;
    }
    form {
      background: var(--card-bg);
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      margin-bottom: 16px;
      transition: background 0.3s;
    }
    form h3 {
      margin-top: 0;
      color: var(--primary);
      font-size: 18px;
    }
    label {
      display: block;
      font-size: 14px;
      margin: 8px 0 4px;
    }
    input, textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-bottom: 8px;
      font-family: inherit;
      font-size: 14px;
    }
    .form-switch {
      text-align: right;
      margin-top: -8px;
      margin-bottom: 8px;
    }
    .form-switch button {
      background: none;
      border: none;
      color: var(--primary);
      cursor: pointer;
      font-size: 13px;
      text-decoration: underline;
    }
    .actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }
    .actions button {
      flex: 1;
      padding: 10px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      font-size: 14px;
    }
    .actions button:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    /* Search bar */
    #searchInput {
      width: 100%;
      padding: 8px;
      margin-bottom: 16px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 14px;
    }

    /* Recipes grid */
    #recipeList {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 16px;
    }
    .recipe-card {
      background: var(--card-bg);
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 12px;
      position: relative;
      transition: box-shadow 0.2s;
    }
    .recipe-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .recipe-card h3 {
      margin: 0 0 8px;
      color: var(--primary);
      font-size: 18px;
    }
    .recipe-card p {
      margin: 4px 0;
      font-size: 14px;
    }
    .card-btns {
      display: flex;
      gap: 6px;
      margin-top: 8px;
    }
    .card-btns button {
      background: var(--primary);
      border: none;
      color: white;
      border-radius: 4px;
      padding: 4px 6px;
      font-size: 12px;
      cursor: pointer;
    }
    .card-btns button:hover {
      background: var(--primary-dark);
    }
    .logout-btn {
      background: none;
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
      display: none;
    }
    /* Confirmation dialog */
    .modal-backdrop {
      position: fixed;
      top:0;left:0;
      width:100%;height:100%;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
    }
    .modal {
      background: var(--card-bg);
      padding: 16px;
      border-radius: 8px;
      width: 90%;
      max-width: 320px;
      text-align: center;
    }
    .modal button {
      margin: 8px;
      width: 90px;
    }
  </style>
</head>
<body>

<header>
  <div class="brand">
    <img id="chefLogo" src="https://via.placeholder.com/40" alt="Chef Logo">
    <h1>Smart Chef</h1>
  </div>
  <div>
    <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
    <button class="logout-btn" onclick="logoutUser()">‚èª</button>
  </div>
</header>

<main class="container">

  <!-- Toggle between Register & Login -->
  <form id="registerForm">
    <h3>Register</h3>
    <label for="regUsername">Username</label>
    <input id="regUsername" type="text" required>
    <label for="regPassword">Password</label>
    <input id="regPassword" type="password" required>
    <button type="submit">Register</button>
    <div class="form-switch">
      Already have an account?
      <button type="button" onclick="showLogin()">Login</button>
    </div>
  </form>

  <form id="loginForm" style="display:none;">
    <h3>Login</h3>
    <label for="loginUsername">Username</label>
    <input id="loginUsername" type="text" required>
    <label for="loginPassword">Password</label>
    <input id="loginPassword" type="password" required>
    <button type="submit">Login</button>
    <div id="g_id_onload"
         data-client_id="YOUR_GOOGLE_CLIENT_ID"
         data-callback="handleGoogleLogin"></div>
    <div class="g_id_signin" data-type="standard"></div>
    <div class="form-switch">
      New here?
      <button type="button" onclick="showRegister()">Register</button>
    </div>
  </form>

  <!-- App UI -->
  <section id="app" style="display:none;">
    <input id="searchInput" type="text" placeholder="Search recipes by name‚Ä¶">

    <div class="actions">
      <button onclick="startVoiceSearch()">üé§ Voice Search</button>
      <button onclick="startVoiceAdd()">üéôÔ∏è Voice Add</button>
    </div>

    <form id="recipeForm">
      <h3>Add New Recipe</h3>
      <label for="recipeName">Name</label>
      <input id="recipeName" type="text" required>
      <label for="recipeIngredients">Ingredients (comma-separated)</label>
      <input id="recipeIngredients" type="text" required>
      <label for="recipeSteps">Steps (‚Üí separated)</label>
      <textarea id="recipeSteps" required></textarea>
      <button type="submit">Add Recipe</button>
    </form>

    <div id="recipeList"></div>
  </section>

</main>

<!-- Delete Confirmation Modal -->
<div id="modal" class="modal-backdrop" role="dialog" aria-modal="true">
  <div class="modal">
    <p>Are you sure you want to delete this recipe?</p>
    <button onclick="confirmDelete()">Yes</button>
    <button onclick="closeModal()">No</button>
  </div>
</div>

<script>
  let currentUser = null, recipes = [], pendingDelete = null;

  // Theme
  function toggleTheme() {
    const t = document.documentElement.getAttribute('data-theme') === 'dark' ? '' : 'dark';
    document.documentElement.setAttribute('data-theme', t);
  }

  // Show forms
  function showLogin() { registerForm.style.display='none'; loginForm.style.display='block'; }
  function showRegister() { loginForm.style.display='none'; registerForm.style.display='block'; }

  // Persist session
  function loadSession(){
    const saved = localStorage.getItem('currentUser');
    if(saved){
      currentUser = JSON.parse(saved);
      chefLogo.src = currentUser.logo || 'https://via.placeholder.com/40';
      chefName.textContent = currentUser.username;
      registerForm.style.display = loginForm.style.display = 'none';
      logoutBtn.style.display = 'inline';
      app.style.display = 'block';
      recipes = JSON.parse(localStorage.getItem('recipes_'+currentUser.username))||[];
      renderRecipes();
    }
  }

  // Register
  registerForm.addEventListener('submit', e=>{
    e.preventDefault();
    const u=regUsername.value.trim(),
          p=regPassword.value.trim();
    if(localStorage.getItem('user_'+u)){
      return alert('That username is taken');
    }
    localStorage.setItem('user_'+u, JSON.stringify({ username:u,password:btoa(p) }));
    alert('Registered! Now login.');
    showLogin();
  });

  // Login
  loginForm.addEventListener('submit', e=>{
    e.preventDefault();
    const u=loginUsername.value.trim(),
          p=loginPassword.value.trim(),
          stored=localStorage.getItem('user_'+u);
    if(!stored) return alert('User not found');
    const data=JSON.parse(stored);
    if(atob(data.password)!==p) return alert('Wrong password');
    currentUser={ username: u, logo: '' };
    localStorage.setItem('currentUser', JSON.stringify(currentUser));
    loadSession();
  });

  // Google Login Callback
  function handleGoogleLogin(resp){
    const d=JSON.parse(atob(resp.credential.split('.')[1]));
    currentUser={ username:d.name, logo:d.picture };
    localStorage.setItem('currentUser', JSON.stringify(currentUser));
    localStorage.setItem('user_'+d.name, JSON.stringify({ username:d.name,password:'' }));
    loadSession();
  }

  // Logout
  function logoutUser(){
    localStorage.removeItem('currentUser');
    location.reload();
  }

  // Render & filter
  searchInput.addEventListener('input',renderRecipes);
  function renderRecipes(){
    recipeList.innerHTML='';
    const q=searchInput.value.trim().toLowerCase();
    recipes.filter(r=>r.name.toLowerCase().includes(q))
      .forEach((r,i)=>{
      const card=document.createElement('div');
      card.className='recipe-card';
      card.innerHTML=`
        <h3>${r.name}</h3>
        <p><strong>Ingredients:</strong> ${r.ingredients}</p>
        <p><strong>Steps:</strong> ${r.steps}</p>
        <div class="card-btns">
          <button onclick="promptDelete(${i})">Delete</button>
        </div>`;
      recipeList.append(card);
    });
    localStorage.setItem('recipes_'+currentUser.username,JSON.stringify(recipes));
  }

  // Add recipe
  recipeForm.addEventListener('submit', e=>{
    e.preventDefault();
    recipes.push({
      name: recipeName.value.trim(),
      ingredients: recipeIngredients.value.trim(),
      steps: recipeSteps.value.trim()
    });
    recipeForm.reset();
    renderRecipes();
  });

  // Confirm delete
  function promptDelete(idx){
    pendingDelete = idx;
    modal.style.display = 'flex';
  }
  function confirmDelete(){
    recipes.splice(pendingDelete,1);
    closeModal();
    renderRecipes();
  }
  function closeModal(){
    modal.style.display = 'none';
    pendingDelete = null;
  }

  // Voice Search
  function startVoiceSearch(){
    if(!('SpeechRecognition' in window || 'webkitSpeechRecognition' in window)){
      return alert('Your browser lacks voice support');
    }
    const R=window.SpeechRecognition||webkitSpeechRecognition,
          recog=new R();
    recog.lang='en-US';
    recog.onresult=e=>{
      searchInput.value=e.results[0][0].transcript;
      renderRecipes();
    };
    recog.start();
  }

  // Voice Add
  function startVoiceAdd(){
    if(!('SpeechRecognition' in window||'webkitSpeechRecognition'in window)){
      return alert('Voice not supported');
    }
    const R=window.SpeechRecognition||webkitSpeechRecognition,
          recog=new R();
    recog.lang='en-US';
    alert('Say: Name, Ingredients, Steps');
    recog.onresult=e=>{
      const parts=e.results[0][0].transcript.split(',');
      if(parts.length<3) return alert('Please speak: name, ingredients, steps');
      recipes.push({
        name: parts[0].trim(),
        ingredients: parts[1].trim(),
        steps: parts[2].trim()
      });
      renderRecipes();
      alert('Recipe added!');
    };
    recog.start();
  }

  // Init
  loadSession();
</script>
</body>
</html>
